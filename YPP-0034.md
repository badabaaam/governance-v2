# Proposal

Introduce FRAX as a borrowable asset.

# Background

You can find more details [here](https://gov.frax.finance/t/yield-protocol-frax-proposal-call-for-comments/835)

# Details

The summary of the execution is as follows:

1. Deploy Accumulator Oracle (no need for governance approval)
2. Deploy FRAX Join (no need for governance approval)
3. Deploy the FYFRAX2209 and FYFRAX2303 fyToken & pools (no need for governance approval)
4. Deploy YSFRAX1YEV and YSFRAX1YOD strategies (no need for governance approval)
5. Deploy OnChainTest (no need for governance approval)
6. Governance proposal
   a. Update chi and rate in accumulator oracle
   b. Update Chainlink sources
   c. Update sources in the Composite Oracle
   d. Update Paths in the Composite Oracle
   e. Add FRAX as an asset
   f. Make FRAX a base
   g. Approve DAI, USDC, WBTC, WSTETH, ENS and LINK as collaterals for FRAX using the Composite Oracle
   h. Approve ETH as collateral for FRAX using the Chainlink Oracle
   i. Add the FYFRAX2209 and FYFRAX2303 fyToken and pools as series
   j. Initialize the FYETH2206 and FYETH2209 pools with 100 FRAX each, and burn the LP tokens
   k. Orchestrate the YSETH6MMS and YSETH6MJD strategies
   l. Initialize the YSETH6MMS and YSETH6MJD strategies with 100 FRAX each, and burn the strategy tokens

These steps in 6 are encoded into the [addFraxSeries.ts](https://github.com/yieldprotocol/environments-v2/blob/aeb8eb9d8f45052103f0514adef129616c27ebea/scripts/governance/addSeries/addFraxSeries/addFraxSeries.ts) scripts, while the steps 1 to 5 are the regular deployment scripts from the [environment deployment](https://github.com/yieldprotocol/environments-v2/tree/feat/eth-series/scripts/governance/redeploy).

[This input](https://github.com/yieldprotocol/environments-v2/blob/aeb8eb9d8f45052103f0514adef129616c27ebea/scripts/governance/addSeries/addFraxSeries/addFraxSeries.mainnet.config.ts) will be used:

## Proposal Config

```
export const rateChiSources: Array<[string, string, string, string]> = [
  [FRAX, RATE, WAD.toString(), WAD.toString()],
  [FRAX, CHI, WAD.toString(), WAD.toString()],
]

// Assets that will be made into a base
export const bases: Array<[string, string]> = [[FRAX, newJoins.get(FRAX) as string]]

export const assetsToAdd: Map<string, string> = new Map([[FRAX, assets.get(FRAX) as string]])

export const chainlinkSources: Array<[string, string, string, string, string]> = [
  [FRAX, assets.get(FRAX) as string, ETH, assets.get(ETH) as string, '0x14d04Fff8D21bd62987a5cE9ce543d2F1edF5D3E'],
]

export const newChiSources: Array<[string, string]> = [[FRAX, protocol.get(ACCUMULATOR) as string]]

export const newRateSources: Array<[string, string]> = [[FRAX, protocol.get(ACCUMULATOR) as string]]

export const compositeSources: Array<[string, string, string]> = [
  [FRAX, ETH, protocol.get(CHAINLINK) as string],
]

export const newCompositePaths: Array<[string, string, Array<string>]> = [
  [FRAX, ENS, [ETH]],
  [FRAX, WSTETH, [ETH, STETH]],
]

// Input data: baseId, ilkId, ratio (1000000 == 100%), line, dust, dec
export const newChainlinkLimits: Array<[string, string, number, number, number, number]> = [
  [FRAX, FRAX, 1000000, 5000000, 5000, 18],
  [FRAX, ETH, 1400000, 1000000, 5000, 18],
  [FRAX, DAI, 1330000, 1000000, 5000, 18],
  [FRAX, USDC, 1330000, 1000000, 5000, 18],
  [FRAX, WBTC, 1500000, 1000000, 5000, 18],
  [FRAX, LINK, 1670000, 1000000, 5000, 18],
  [FRAX, UNI, 1670000, 1000000, 5000, 18],
]

// Input data: baseId, ilkId, ratio (1000000 == 100%), line, dust, dec
export const newCompositeLimits: Array<[string, string, number, number, number, number]> = [
  [FRAX, WSTETH, 1400000, 1000000, 5000, 18],
  [FRAX, ENS, 1670000, 1000000, 5000, 18],
]

// seriesId, underlyingId, chiOracleAddress, joinAddress, maturity, name, symbol
export const fyTokenData: Array<[string, string, string, string, number, string, string]> = [
  [
    FYFRAX2206,
    FRAX,
    protocol.get(ACCUMULATOR) as string,
    newJoins.get(FRAX) as string,
    EOJUN22,
    'FYFRAX2206',
    'FYFRAX2206',
  ],
  [
    FYFRAX2209,
    FRAX,
    protocol.get(ACCUMULATOR) as string,
    newJoins.get(FRAX) as string,
    EOSEP22,
    'FYFRAX2209',
    'FYFRAX2209',
  ]
]

// seriesId, baseAddress, fyTokenAddress, ts (time stretch), g1 (Sell base to the pool fee), g2 (Sell fyToken to the pool fee)
export const poolData: Array<[string, string, string, BigNumber, BigNumber, BigNumber]> = [
  [
    FYFRAX2206,
    assets.get(FRAX) as string,
    newFYTokens.get(FYFRAX2206) as string,
    ONE64.div(secondsIn40Years),
    ONE64.mul(75).div(100),
    ONE64.mul(100).div(75),
  ],
  [
    FYFRAX2209,
    assets.get(FRAX) as string,
    newFYTokens.get(FYFRAX2209) as string,
    ONE64.div(secondsIn40Years),
    ONE64.mul(75).div(100),
    ONE64.mul(100).div(75),
  ]
]

// seriesId, initAmount
export const poolsInit: Array<[string, string, BigNumber, BigNumber]> = [
  [FYFRAX2206, FRAX, WAD, ZERO],
  [FYFRAX2209, FRAX, WAD, ZERO],
]

// seriesId, accepted ilks
export const seriesIlks: Array<[string, string[]]> = [
  [FYFRAX2206, [ETH, DAI, USDC, WBTC, WSTETH, LINK, ENS, UNI]],
  [FYFRAX2209, [ETH, DAI, USDC, WBTC, WSTETH, LINK, ENS, UNI]],
]

export const strategiesData: Array<[string, string, string, string, string]> = [
  // name, symbol, baseId
  ['Yield Strategy FRAX 6M Mar Sep', YSFRAX6MMS, FRAX, newJoins.get(FRAX) as string, assets.get(FRAX) as string],
  ['Yield Strategy FRAX 6M Jun Dec', YSFRAX6MJD, FRAX, newJoins.get(FRAX) as string, assets.get(FRAX) as string],
]

// Input data
export const strategiesInit: Array<[string, string, string, BigNumber]> = [
  // [strategyId, startPoolAddress, startPoolId, initAmount]
  [YSFRAX6MMS, newPools.get(FYFRAX2209) as string, FYFRAX2209, WAD],
  [YSFRAX6MJD, newPools.get(FYFRAX2206) as string, FYFRAX2206, WAD],
]

// Input data: ilkId, duration, initialOffer, auctionLine, auctionDust, dec
export const chainlinkAuctionLimits: Array<[string, number, number, number, number, number]> = [
  [FRAX, 3600, 1000000, 1000000, 5000, 18],
]


```

# Testing

The series was tested by running [this test](https://github.com/yieldprotocol/environments-v2/blob/aeb8eb9d8f45052103f0514adef129616c27ebea/scripts/governance/addSeries/addFraxSeries/addFraxSeries.test.ts)

Here is the result:

```
+ npx hardhat run --network localhost ./scripts/governance/addSeries/addFraxSeries/addFraxSeries.test.ts
No need to generate any newer typings.
ChainId: 4
Running on a fork, impersonating 0x5AD7799f02D5a829B2d6FA085e6bd69A872619D5
series: 0x303330370000
ilk: 0x303000000000
vault: 0x572e3036d1e720706a116f5c
posting 2107549890600000000 ilk out of 1000000000000000000000
borrowing 5000000000000000000000 FYFRAX2209
posted and borrowed
repaying 5000000000000000000000 FYFRAX2209 and withdrawing 2107549890600000000 ilk
repaid and withdrawn
series: 0x303330370000
ilk: 0x303100000000
vault: 0xf98c1948c226d526c37c5ee0
posting 6520194538145732583609 ilk out of 100300000000000000000000
borrowing 5000000000000000000000 FYFRAX2209
posted and borrowed
repaying 5000000000000000000000 FYFRAX2209 and withdrawing 6520194538145732583609 ilk
repaid and withdrawn
series: 0x303330370000
ilk: 0x303200000000
vault: 0xe1f20bf3a804986c56875683
posting 6447521170 ilk out of 1000000000000000000000
borrowing 5000000000000000000000 FYFRAX2209
posted and borrowed
repaying 5000000000000000000000 FYFRAX2209 and withdrawing 6447521170 ilk
repaid and withdrawn
series: 0x303330370000
ilk: 0x303300000000
vault: 0x8f0e658714c7e658491bb034
posting 16780124 ilk out of 1000000000000000000000
borrowing 5000000000000000000000 FYFRAX2209
posted and borrowed
repaying 5000000000000000000000 FYFRAX2209 and withdrawing 16780124 ilk
repaid and withdrawn
series: 0x303330370000
ilk: 0x303400000000
vault: 0xa1954f68782479f5ccb1863d
posting 2027321494720232933 ilk out of 1000000000000000000000
borrowing 5000000000000000000000 FYFRAX2209
posted and borrowed
repaying 5000000000000000000000 FYFRAX2209 and withdrawing 2027321494720232933 ilk
repaid and withdrawn
series: 0x303330370000
ilk: 0x303600000000
vault: 0x33ccfb45707a766b375f7481
posting 521253564364503421106 ilk out of 1000000000000000000000
borrowing 5000000000000000000000 FYFRAX2209
posted and borrowed
repaying 5000000000000000000000 FYFRAX2209 and withdrawing 521253564364503421106 ilk
repaid and withdrawn
series: 0x303330370000
ilk: 0x303700000000
vault: 0xafe39f5105cef457f1284fad
posting 171033959816638966123 ilk out of 1000000000000000000000
borrowing 5000000000000000000000 FYFRAX2209
posted and borrowed
repaying 5000000000000000000000 FYFRAX2209 and withdrawing 171033959816638966123 ilk
repaid and withdrawn
series: 0x303330370000
ilk: 0x313000000000
vault: 0x8a26a7a459149eb8da51a5ca
posting 556733603047275403447 ilk out of 998000000000000000000000000
borrowing 5000000000000000000000 FYFRAX2209
posted and borrowed
repaying 5000000000000000000000 FYFRAX2209 and withdrawing 556733603047275403447 ilk
repaid and withdrawn
series: 0x303330390000
ilk: 0x303000000000
vault: 0x99ae3f1d4afb37f22d937c1c
posting 2107549890600000000 ilk out of 2000000000000000000000
borrowing 5000000000000000000000 FYFRAX2303
posted and borrowed
repaying 5000000000000000000000 FYFRAX2303 and withdrawing 2107549890600000000 ilk
repaid and withdrawn
series: 0x303330390000
ilk: 0x303100000000
vault: 0x8f26e8c09742a905202e5318
posting 6520194538145732583609 ilk out of 101300000000000000000000
borrowing 5000000000000000000000 FYFRAX2303
posted and borrowed
repaying 5000000000000000000000 FYFRAX2303 and withdrawing 6520194538145732583609 ilk
repaid and withdrawn
series: 0x303330390000
ilk: 0x303200000000
vault: 0xed69b94d9aef33df75f182fd
posting 6447521170 ilk out of 2000000000000000000000
borrowing 5000000000000000000000 FYFRAX2303
posted and borrowed
repaying 5000000000000000000000 FYFRAX2303 and withdrawing 6447521170 ilk
repaid and withdrawn
series: 0x303330390000
ilk: 0x303300000000
vault: 0x99c6557181e7882ee1351b8c
posting 16780124 ilk out of 2000000000000000000000
borrowing 5000000000000000000000 FYFRAX2303
posted and borrowed
repaying 5000000000000000000000 FYFRAX2303 and withdrawing 16780124 ilk
repaid and withdrawn
series: 0x303330390000
ilk: 0x303400000000
vault: 0xe3a33af13a6c2507f5efb181
posting 2027321494720232933 ilk out of 2000000000000000000000
borrowing 5000000000000000000000 FYFRAX2303
posted and borrowed
repaying 5000000000000000000000 FYFRAX2303 and withdrawing 2027321494720232933 ilk
repaid and withdrawn
series: 0x303330390000
ilk: 0x303600000000
vault: 0x9c432dabb6418a40ca2047b2
posting 521253564364503421106 ilk out of 2000000000000000000000
borrowing 5000000000000000000000 FYFRAX2303
posted and borrowed
repaying 5000000000000000000000 FYFRAX2303 and withdrawing 521253564364503421106 ilk
repaid and withdrawn
series: 0x303330390000
ilk: 0x303700000000
vault: 0xab99f16012fbedad798d3717
posting 171033959816638966123 ilk out of 2000000000000000000000
borrowing 5000000000000000000000 FYFRAX2303
posted and borrowed
repaying 5000000000000000000000 FYFRAX2303 and withdrawing 171033959816638966123 ilk
repaid and withdrawn
series: 0x303330390000
ilk: 0x313000000000
vault: 0x2f817f5e11ff7bf3fef58e62
posting 556733603047275403447 ilk out of 998000000000000000000000000
borrowing 5000000000000000000000 FYFRAX2303
posted and borrowed
repaying 5000000000000000000000 FYFRAX2303 and withdrawing 556733603047275403447 ilk
repaid and withdrawn
```
