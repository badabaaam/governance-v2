# Proposal
Release March 2022 and June 2022 ETH series.

# Background
<TBA> 

# Details

The summary of the execution is as follows:
1. Deploy YSETH6MMS and YSETH6MJD strategies (no need for governance approval)
2. Update Chi Sources for ETH in the Compound Oracle
3. Update Rate Sources for ETH in the Compound Oracle
4. Update Paths in the Composite Oracle for ETH -> STETH -> WSTETH
5. Make ETH into an underlying
6. Approve ETH, DAI, USDC, WBTC and LINK as collaterals for ETH using the Chainlink Oracles, with existing price feeds
7. Approve WSTETH as collateral for ETH using the Composite Oracles, with existing price feeds
8. Approve ENS as collateral for ETH using the Uniswap Oracle, with existing price feeds
9. Release the FYETH2203 and FYETH2206 ETH series
10. Orchestrate the FYETH2203 and FYETH2206 series
11. Initialize the FYETH2203 and FYETH2206 pools with 0.02 ETH each, and burn the LP tokens
12. Orchestrate the YSETH6MMS and YSETH6MJD strategies
13. Initialize the YSETH6MMS and YSETH6MJD strategies with 0.02 ETH each, and burn the strategy tokens

These steps are encoded into the [addEthSeries-1.ts](https://github.com/yieldprotocol/environments-v2/blob/b49943aa0feb4d3b3f96828fd3aa3b0d86eecf57/scripts/governance/addEthSeries/addEthSeries-1.ts), [addEthSeries-2.ts](https://github.com/yieldprotocol/environments-v2/blob/b49943aa0feb4d3b3f96828fd3aa3b0d86eecf57/scripts/governance/addEthSeries/addEthSeries-2.ts) and [addEthSeries-3.ts](https://github.com/yieldprotocol/environments-v2/blob/b49943aa0feb4d3b3f96828fd3aa3b0d86eecf57/scripts/governance/addEthSeries/addEthSeries-3.ts) scripts.

[This input](https://github.com/yieldprotocol/environments-v2/blob/b49943aa0feb4d3b3f96828fd3aa3b0d86eecf57/scripts/governance/addEthSeries/addEthSeries.config.ts) will be used:

```
import { BigNumber } from 'ethers'
import { ETH, DAI, USDC, WBTC, WSTETH, STETH, LINK, ENS, WAD } from '../../../shared/constants'
import { EOMAR22, EOJUN22, FYETH2203, FYETH2206, YSETH6MMS, YSETH6MJD } from '../../../shared/constants'
import { CHAINLINK, COMPOSITE, UNISWAP } from '../../../shared/constants'

export const WAD = BigNumber.from(10).pow(18)

export const ETH    = ethers.utils.formatBytes32String('00').slice(0, 14)
export const DAI    = ethers.utils.formatBytes32String('01').slice(0, 14)
export const USDC   = ethers.utils.formatBytes32String('02').slice(0, 14)
export const WBTC   = ethers.utils.formatBytes32String('03').slice(0, 14)
export const WSTETH = ethers.utils.formatBytes32String('04').slice(0, 14)
export const STETH  = ethers.utils.formatBytes32String('05').slice(0, 14)
export const LINK   = ethers.utils.formatBytes32String('06').slice(0, 14)
export const ENS    = ethers.utils.formatBytes32String('07').slice(0, 14)

export const CHAINLINK = 'chainlinkOracle'
export const COMPOSITE = 'compositeOracle'
export const UNISWAP   = 'uniswapOracle'

export const EOMAR22 = 1648177200
export const EOJUN22 = 1656039600 // Friday, June 24, 2022 3:00:00 PM GMT+0

export const FYETH2203  = ethers.utils.formatBytes32String('0005').slice(0, 14) // End of 5th quarter from 1st January 2021
export const FYETH2206  = ethers.utils.formatBytes32String('0006').slice(0, 14) // End of 6th quarter from 1st January 2021

export const YSETH6MMS  = 'YSETH6MMS' // Yield Strategy ETH 6M Mar Sep
export const YSETH6MJD  = 'YSETH6MJD' // Yield Strategy ETH 6M Jun Dec


export const assets: Map<number, Map<string, string>> = new Map([
  [1, new Map([
    [ETH,    '0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2'],
    [DAI,    '0x6B175474E89094C44Da98b954EedeAC495271d0F'],
    [USDC,   '0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48'],
    [WBTC,   '0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599'],
    [WSTETH, '0x7f39C581F595B53c5cb19bD0b3f8dA6c935E2Ca0'],
    [STETH,  '0xae7ab96520DE3A18E5e111B5EaAb095312D7fE84'],
    [LINK,   '0x514910771af9ca656af840dff83e8264ecf986ca'],
    [ENS,    '0xC18360217D8F7Ab5e7c516566761Ea12Ce7F9D72'],
  ])],
])

export const poolsInit: Array<[string, BigNumber]> = [
  // poolId, initAmount
  [FYETH2203, WAD.div(50)],
  [FYETH2206, WAD.div(50)],
]

export const newSeries: Array<[string, string, number, string[], string, string]> = [
  // name, baseId, maturity, ilkIds, name, symbol
  [FYETH2203, ETH, EOMAR22, [ETH, DAI, USDC, WBTC, WSTETH, LINK, ENS], 'FYETH2203', 'FYETH2203'], // Mar22
  [FYETH2206, ETH, EOJUN22, [ETH, DAI, USDC, WBTC, WSTETH, LINK, ENS], 'FYETH2206', 'FYETH2206'], // Jun22
]

export const newStrategies: Array<[string, string, string]> = [
  // name, symbol, baseId
  ['Yield Strategy ETH 6M Mar Sep',  YSETH6MMS,  ETH],
  ['Yield Strategy ETH 6M Jun Dec',  YSETH6MJD,  ETH],
]

// Input data
export const strategiesInit: Array<[string, string, BigNumber]> = [
  // [strategyId, startPoolId, initAmount]
  [YSETH6MMS, FYETH2203, WAD.div(50)], // The March/September Strategy invests in the March series
  [YSETH6MJD, FYETH2206, WAD.div(50)], // The June/December Strategy invests in the June series
]

export const newChiSources = new Map([
  [1,  [[ETH, '0x4ddc2d193948926d02f9b1fe9e1daa0718270ed5']]],
])

export const newRateSources = new Map([
  [1,  [[ETH, '0x4ddc2d193948926d02f9b1fe9e1daa0718270ed5']]],
])

// Input data: assetId, assetId, [intermediate assetId]
export const newCompositePaths: Array<[string, string, Array<string>]> = [
  [ETH, WSTETH, [STETH]],
]

export const newBases: Array<string> = [ETH]

// Input data: baseId, ilkId, oracle name, ratio (1000000 == 100%), inv(ratio), line, dust, dec
export const newChainlinkLimits: Map<number, Array<[string, string, string, number, number, number, number, number]>> = new Map([
  [1, [
    [ETH, ETH,  CHAINLINK, 1000000, 1000000, 2500000000, 0,     12], // Constant 1, no dust
    [ETH, DAI,  CHAINLINK, 1500000, 666000,  250000000,  10000, 12],
    [ETH, USDC, CHAINLINK, 1500000, 666000,  250000000,  10000, 12],
    [ETH, WBTC, CHAINLINK, 1500000, 666000,  250000000,  10000, 12],
    [ETH, LINK, CHAINLINK, 1500000, 666000,  250000000,  10000, 12],
  ]],
])

// Input data: baseId, ilkId, oracle name, ratio (1000000 == 100%), inv(ratio), line, dust, dec
export const newCompositeLimits: Array<[string, string, string, number, number, number, number, number]> = [
  [ETH, WSTETH, COMPOSITE, 1000000, 666000, 250000000, 10000, 12],
]

// Input data: baseId, ilkId, oracle name, ratio (1000000 == 100%), inv(ratio), line, dust, dec
export const newUniswapLimits: Map<number, Array<[string, string, string, number, number, number, number, number]>> = new Map([
  [1,  [[ETH, ENS, UNISWAP,   1500000, 666000, 250000000, 10000, 12]]],
])
```

1. Deploy YSETH6MMS and YSETH6MJD strategies (no need for governance approval)
2. Update Chi Sources for ETH in the Compound Oracle
3. Update Rate Sources for ETH in the Compound Oracle
4. Update Paths in the Composite Oracle for ETH -> STETH -> WSTETH
5. Make ETH into an underlying
6. Approve ETH, DAI, USDC, WBTC and LINK as collaterals for ETH using the Chainlink Oracles, with existing price feeds
7. Approve WSTETH as collateral for ETH using the Composite Oracles, with existing price feeds
8. Approve ENS as collateral for ETH using the Uniswap Oracle, with existing price feeds
9. Release the FYETH2203 and FYETH2206 ETH series
10. Orchestrate the FYETH2203 and FYETH2206 series
11. Initialize the FYETH2203 and FYETH2206 pools with 0.02 ETH each, and burn the LP tokens
12. Orchestrate the YSETH6MMS and YSETH6MJD strategies
13. Initialize the YSETH6MMS and YSETH6MJD strategies with 0.02 ETH each, and burn the strategy tokens

```
# Testing
The change has been tested on a mainnet fork by posting LINK to all series, borrowing, repaying and wthdrawing. [Script](https://github.com/yieldprotocol/environments-v2/blob/b49943aa0feb4d3b3f96828fd3aa3b0d86eecf57/scripts/governance/addEthSeries/addEthSeries.test.ts).
```
alberto@alberto-laptop:~/Code/Yield/environments-v2$ npx hardhat run --network localhost ./scripts/governance/addEthSeries/addEthSeries.test.ts 
No need to generate any newer typings.
ChainId: 1
Running on a fork, impersonating 0xC7aE076086623ecEA2450e364C838916a043F9a8
series: 0x303030350000
vault: 0x26f9c9f569fd97e5d34e8944
posting 9682448240560674 wstETH out of 38077062721258366484
borrowing 10000000000000000 fyETH
posted and borrowed
repaying 10000000000000000 fyETH and withdrawing 9682448240560674 wstETH
repaid and withdrawn
series: 0x303030360000
vault: 0x6bf833a3050d52142696a10f
posting 9682448240560674 wstETH out of 38077062721258366484
borrowing 10000000000000000 fyETH
posted and borrowed
repaying 10000000000000000 fyETH and withdrawing 9682448240560674 wstETH
repaid and withdrawn
```